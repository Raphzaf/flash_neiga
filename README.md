# Flash Neiga - Driving Test Preparation App

A comprehensive web application for preparing for driving theory exams, featuring a React frontend and FastAPI backend.

## üèóÔ∏è Project Structure

```
flash_neiga/
‚îú‚îÄ‚îÄ backend/          # FastAPI backend application
‚îÇ   ‚îú‚îÄ‚îÄ server.py     # Main FastAPI application
‚îÇ   ‚îú‚îÄ‚îÄ database.py   # Database configuration
‚îÇ   ‚îú‚îÄ‚îÄ models.py     # Data models
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ frontend/         # React frontend application
‚îú‚îÄ‚îÄ data/            # Sample questions and data
‚îî‚îÄ‚îÄ render.yaml      # Render deployment configuration
```

## üöÄ Deployment

### Backend Deployment on Render

The backend is configured to deploy on Render using the `render.yaml` configuration file.

#### Prerequisites

1. A Render account ([sign up here](https://render.com))
2. GitHub repository connected to Render

#### Deployment Steps

1. **Connect Repository to Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" and select "Blueprint"
   - Connect your GitHub repository
   - Select the `flash_neiga` repository

2. **Render will automatically detect `render.yaml`**
   - The configuration includes:
     - Web service: `flash-neiga-backend`
     - Python environment (3.11)
     - PostgreSQL database (free tier)
     - Auto-generated SECRET_KEY

3. **Set Environment Variables** (Optional)
   
   The following environment variables can be configured in Render Dashboard:
   
   - `SECRET_KEY` - Auto-generated by Render (or set your own)
   - `PYTHON_VERSION` - Set to "3.11" (default)
   - `DATABASE_URL` - Auto-configured from PostgreSQL database
   - `ALLOWED_ORIGINS` - Comma-separated list of allowed frontend URLs (e.g., `https://your-frontend.netlify.app,http://localhost:3000`)
   - `ADMIN_TOKEN` - (Optional) Token for admin endpoints
   - `STRIPE_SECRET_KEY` - (Optional) For payment integration

4. **Deploy**
   - Click "Apply" to start deployment
   - Wait for build and deployment to complete
   - Your API will be available at: `https://flash-neiga-backend.onrender.com`

#### Health Check

The backend includes a health check endpoint at `/health` that Render uses to monitor service status:

```bash
curl https://flash-neiga-backend.onrender.com/health
```

Expected response:
```json
{
  "status": "healthy",
  "service": "flash-neiga-backend",
  "timestamp": "2025-12-14T00:00:00.000000+00:00"
}
```

#### Database Configuration

The application uses **PostgreSQL** for production on Render (free tier) and **SQLite** for local development.

- **Production (Render)**: PostgreSQL database is automatically provisioned and configured
- **Local Development**: SQLite database (`flash_neiga.db`) is created in the `backend/` directory

The backend automatically detects the environment and uses the appropriate database:
- When `DATABASE_URL` environment variable is set ‚Üí PostgreSQL
- When `DATABASE_URL` is not set ‚Üí SQLite (local development)

### Frontend Deployment on Netlify

The frontend can be deployed on Netlify or any static hosting service.

#### Prerequisites

1. A Netlify account ([sign up here](https://www.netlify.com))
2. Your backend deployed on Render and accessible via HTTPS
3. GitHub repository connected to Netlify

#### Deployment Steps

1. **Connect Repository to Netlify**
   - Go to [Netlify Dashboard](https://app.netlify.com)
   - Click "Add new site" ‚Üí "Import an existing project"
   - Connect your GitHub repository
   - Select the `flash_neiga` repository

2. **Configure Build Settings**
   - Build command: `cd frontend && npm run build`
   - Publish directory: `frontend/build`
   - Base directory: (leave empty)

3. **Set Environment Variables**
   
   In Netlify Dashboard ‚Üí Site settings ‚Üí Environment variables, add:
   
   **Required:**
   - `REACT_APP_BACKEND_URL` - Your backend API URL (e.g., `https://flash-neiga-backend.onrender.com`)
     - **Important**: This should be your Render backend URL, NOT localhost
     - Example: `https://your-service-name.onrender.com`
   
   **Optional (for Stripe payments):**
   - `REACT_APP_STRIPE_PUBLISHABLE_KEY` - Your Stripe publishable key (starts with `pk_test_` or `pk_live_`)
   - `REACT_APP_STRIPE_PRICE_CODE_14D` - Stripe Price ID for 14-day code access
   - `REACT_APP_STRIPE_PRICE_CODE_30D` - Stripe Price ID for 30-day code access
   - `REACT_APP_STRIPE_PRICE_VIDEO_1M` - Stripe Price ID for 1-month video access
   - `REACT_APP_STRIPE_PRICE_VIDEO_2M` - Stripe Price ID for 2-month video access
   - `REACT_APP_STRIPE_PRICE_VIDEO_3M` - Stripe Price ID for 3-month video access
   - `REACT_APP_STRIPE_PRICING_TABLE_ID` - Stripe Pricing Table ID (starts with `prctbl_`)

4. **Deploy**
   - Click "Deploy site"
   - Wait for build and deployment to complete
   - Your application will be available at: `https://your-site-name.netlify.app`

5. **Update Backend CORS Settings**
   
   After deployment, update your Render backend environment variables:
   - Add your Netlify URL to `ALLOWED_ORIGINS`: `https://your-site-name.netlify.app,http://localhost:3000`

#### Troubleshooting

**Issue: "ERR_CONNECTION_REFUSED" or "Failed to fetch"**
- ‚úÖ Verify `REACT_APP_BACKEND_URL` is set correctly in Netlify environment variables
- ‚úÖ Ensure the backend URL uses HTTPS (not HTTP) for production
- ‚úÖ Check that the backend is running: visit `https://your-backend.onrender.com/health`
- ‚úÖ Verify CORS is configured: add your Netlify URL to backend's `ALLOWED_ORIGINS`
- ‚úÖ Redeploy the frontend after changing environment variables (they only apply on build)

**Issue: Environment variables not working**
- ‚úÖ Make sure variable names start with `REACT_APP_` (required by Create React App)
- ‚úÖ Redeploy the site after adding/changing environment variables
- ‚úÖ Check browser console for the debug log: "üîó Backend URL: ..." (only in development mode)

**Issue: 401 Unauthorized errors**
- ‚úÖ Clear browser localStorage and login again
- ‚úÖ Check that JWT token is being sent in requests (visible in Network tab)

## üíª Local Development

### Backend Setup

1. **Navigate to backend directory**
   ```bash
   cd backend
   ```

2. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Run the server**
   ```bash
   # Development
   python server.py
   
   # Or with uvicorn directly
   uvicorn server:app --reload --host 0.0.0.0 --port 8000
   ```

4. **Access the API**
   - API: http://localhost:8000
   - API Documentation: http://localhost:8000/docs
   - Health Check: http://localhost:8000/health

### Frontend Setup

1. **Navigate to frontend directory**
   ```bash
   cd frontend
   ```

2. **Create environment file** (optional for local development)
   ```bash
   cp .env.example .env
   ```
   
   The default `.env` file includes:
   ```env
   REACT_APP_BACKEND_URL=http://localhost:8000
   ```
   
   For local development, this is already configured. Only modify if your backend runs on a different port.

3. **Install dependencies**
   ```bash
   npm install
   ```

4. **Run development server**
   ```bash
   npm start
   ```

5. **Access the application**
   - Frontend: http://localhost:3000
   - The frontend will automatically proxy API requests to `http://localhost:8000` via the configured `REACT_APP_BACKEND_URL`

## üîß Configuration

### Database

The backend supports both PostgreSQL (production) and SQLite (local development):

**Production (Render)**:
- Uses PostgreSQL (free tier)
- Database is automatically provisioned and managed by Render
- Connection string is auto-configured via `DATABASE_URL` environment variable
- Database name: `flash_neiga`
- User: `flash_neiga_user`

**Local Development**:
- Uses SQLite for simplicity
- Database file (`flash_neiga.db`) is stored in the `backend/` directory
- No configuration needed - automatically created on first run

### CORS Configuration

CORS is configured to allow requests from any origin by default. For production, set the `ALLOWED_ORIGINS` environment variable:

```bash
ALLOWED_ORIGINS=https://your-frontend.netlify.app,https://your-custom-domain.com
```

## üìã API Endpoints

### Authentication
- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - Login user
- `GET /api/auth/me` - Get current user

### Questions
- `GET /api/questions` - Get all questions (with optional category filter)
- `POST /api/questions` - Create new question

### Exams
- `POST /api/exam/start` - Start new exam session
- `GET /api/exam/{exam_id}` - Get exam details
- `POST /api/exam/{exam_id}/answer` - Submit answer
- `POST /api/exam/{exam_id}/finish` - Finish exam
- `GET /api/exam/{exam_id}/details` - Get detailed exam results

### Training
- `POST /api/training/check` - Check training answer

### Stats
- `GET /api/stats/summary` - Get stats summary
- `GET /api/stats/details` - Get detailed stats

### Health
- `GET /health` - Health check endpoint

## üîê Security

- Passwords are hashed using bcrypt
- JWT tokens for authentication
- SECRET_KEY should be set in production (auto-generated by Render)
- CORS configured for production domains

## üìù License

[Add your license information here]

## ü§ù Contributing

[Add contribution guidelines here]
